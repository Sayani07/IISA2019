---
title: "Exploring probability distributions for bivariate temporal granularities"
type: "contributed"
author: "<br> Sayani Gupta <br> <i class='fab fa-twitter' style='color:#6CADDE'></i> <i class='fab fa-github'></i> @Sayani07"
date: <font size="5"> Department of Econometrics and Business Statistics <br> February 28, 2019
output:
  xaringan::moon_reader:
    css: ["default","libs/data_viz_theme.css"]
    self_contained: false
    nature:
      ratio: 16:9
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, include=FALSE}
library(knitr)
options(htmltools.dir.version = FALSE, tibble.width = 55, tibble.print_min = 4)
opts_chunk$set(
  echo = FALSE, warning = FALSE, message = FALSE, comment = "#>",
  fig.path = 'figure/', cache.path = 'cache/', fig.align = 'center', 
  fig.width = 12, fig.show = 'hold', fig.height = 6, # 16:9
  cache = TRUE, external = TRUE, dev = 'svglite'
)
read_chunk('R/theme.R')
read_chunk('R/main.R')
```

# <span style="color:DarkBlue"> Motivation - Electricity smart meter technology  (~ 40 billion half hourly observations)

.pull-left[
.center-left[
- Source
<br>
<br>
- Frequency
<br>
<br>
- Time Frame
<br>
<br>
- Spread
<br>
<br>
- Type
]
]

.pull-right[
.center-left[
Department of the Environment and Energy, Australia
<br>
<br>
Half hourly (interval meter reading (Kwh))
<br> 
<br>
2012 to 2014
<br>
<br>
14K (approx.) households based in Newcastle, New South Wales, and parts of Sydney
<br>
<br>
Spatio - Temporal Data
]
]

???
Smart meters record electricity usage (per kWh) every 30 minutes and send this information to the electricity retailer for billing

**Consumers** can save considerable amount on their electricity bill by 
- Switching on their hot water heater or do laundry when energy is cheaper, or when their solar system is generating surplus energy 
- Switching off appliances during peak demands
- Check usage and compare with similar homes 

**Retailers** can reduce costs and increase efficiency
- Lowering metering and connection fees 
- Drawing insights into when customer is home, or sleeping, or even what appliances they are using based on usage figures
- Rewarding customers for mindful usage

Just to give you some perspective I have this data from Department of Energy and Environment, Australia that provides interval meter reading data every 30 minutes from 2012 to 2014. So you can think of it like, that the finest temporal unit here is half hour, whereas the coarsest temporal unit is year. This data is made available for 14k customers located in different local government areas across places.. So this is a data which is spread across both time and space and hence is a spatio-temporal data. 

---

background-image: url("images/problem.png")
class: hide-slide-number

???
Well, there can be numerous ways to analyse this data! But I was interested in answering the question - that given this huge volume and spread, how can one explore this data systematically?
---

## <span style="color:DarkBlue">  Exploratory Data Analysis

Developed by **John Tukey** as a way of _*systematically*_ using the tools of statistics on a problem before a hypotheses about the data were developed.

## Goal

<span style="color:Black"> Provide a platform to <span style="color:Crimson"> systematically explore <span style="color:Black">  multiple perspectives of <span style="color:Crimson"> temporal data <span style="color:Black"> across <span style="color:Crimson"> deconstructed time <span style="color:Black"> to
explore behaviors or summarize the behavior through <span style="color:Crimson"> visualizing probability distributions <span style="color:Black"> to find
 
- regular patterns
- anomalies 

???

Developed by **John Tukey** as a way of _*systematically*_ using the tools of statistics on a problem before a hypotheses about the data were developed. This encourages to break the big problem into pieces and focusing on subsets. So the reduced goal that I set for myself is to look at time only and to provide ... . The smart meter example is the one that motivated me for this problem, how the idea is to provide the same for any temporal data following an hierarchy. 

The key terms are decontructing time amnd visualizing distribution. In the next couples of slides, we will talk about the strength and challenges for each of these. 

---

## <span style="color:DarkBlue"> Decontructing time

<span style="color:#c33c3c"> **Granularities** : <span style="color:Black">  Abstractions of time based on Calendar
<br>

.pull-left[
**Arrangement**  
<span style="color:#c33c3c"><i> Linear</i> : <span style="color:Black"> days, weeks, months, years  
<span style="color:#c33c3c"> <i>Circular</i> : <span style="color:Black"> day-of-week, month-of-year or hour-of-day  
<span style="color:#c33c3c"> <i>Aperiodic</i> : <span style="color:Black"> day-of-month, week-of-month  


**Order**  
<span style="color:#c33c3c"> <i>Single-order-up</i> <span style="color:Black"> :nested within single level of hierarchy viz. kin_uinal  
<br>
<span style="color:#c33c3c"> <i>Multiple-order-up</i> <span style="color:Black"> :nested within multiple levels of hierarchy viz. kin-of-tun, uinal-of-katun

 <span style="color:Crimson">
 <small>
 In Mayan system, the calendar (periodic) was structured as follows: 

<span style="color:Crimson"><i>
1 kin = 1 day  
1 uinal = 20 kin  
1 tun  = 18 uinal  
1 katun = 20 tun  
1 baktun = 20 katun  
</i>
</small>

]


.pull-right[

.center[
## <large>????</large>

<span style="color:Black">
 - <large>How can I compute any granularity given the calendar or hierarchy table?</large>
 <br>
 - <large>What are the exhaustive list of granularities I can look at?</large>
 <br>
 ]
 ]
 
???

The Mayan calendar or Haab has 365 days made up of 18 months of 20 days each, which adds up to 360 days. The remaining five days at the end of the year is an unlucky, dangerous time when Mayans stayed home and neglected all activities to avoid disaster. Thus the Mayan calendar is structured as follows and given this hierarchy we can talk about single and multiple order up granularities. 


---


## <span style="color:DarkBlue"> Visualizing probability distributions



Breaking down the big problem -  two granularities at a time.



<!-- Visualize the  <large><span style="color:Crimson">probability distribution  <span style="color:Black"></large> of the variable across <large> <span style="color:Crimson"></large> bivariate granularities <span style="color:black">.  -->


.pull-left[


#### Types of statistical distribution plots 
- box 
- violin
- ridge
- density
- letter value
- quantiles 

#### Interaction of bivariate granularities
- harmonies
- clashes

]


.pull-right[
.center[
## <large>????</large>
<span style="color:Black">
 - Which bivariate granularities are compatible with each other for visualisation?
 <br>
 - Is it appropriate to draw distribution plots given the number of observations?
 <br>
 - Which probability distribution plots to choose to get the best of exploration? 
 ]
 ]



---

class: center,middle

# <span style="color:MediumVioletRed"> Package gravitas </span>

##   granularity visualisation of time series data 

---

## An example : Electricity smart meter data

<i><small>Data source</i></small> : [<small><i>Department of the Environment and Energy, Australia</i></small>](https://data.gov.au/dataset/4e21dea3-9b87-4610-94c7-15a8a77907ef)

```{r load}
```

### Get set of possible temporal granularities with `search_gran()`

```{r search_gran, echo = TRUE}
```

---

## Create any temporal granularity with `create_gran()`

```{r create_gran, echo = TRUE}
```

---

## Get all possible harmonies with `harmony()`

```{r harmony, echo = TRUE}
```

---

## Explore probability distribution across bivariate temporal granularities with `granplot()`

```{r granplotoverlay}
```

---

```{r granplot}
```

---

## Another example: Cricket data of Indian Premier League

<small><i>Data source</i></small>: [<small><i>Cricsheet</i></small>](http://cricsheet.org/) ,  [<small><i>Kaggle</i></small>](https://www.kaggle.com/josephgpinto/ipl-data-analysis/data)

```{r cricket}
```

---


## Difference in strategy between two top teams


```{r cricketex}
```
